% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% %%SWU Bachelor Thesis Template
% %%Author：xinyu-pu
% %%License：Creative Commons CC BY 4.0
% %%GitHub：https://github.com/jweihe/UCAS_Latex_Template
% %%最后更改于2024/01/022
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% %%在"贵州大学课程论文模板"基础上修改而来
% %%原作者：jweihe
% %%Overleaf地址：https://www.overleaf.com/latex/templates/bnuke-cheng-lun-wen-mo-ban/bcwvxncqffkw


\ProvidesPackage{SWUBachelor}

%%页边距
\RequirePackage[left=2.50cm, right=2.50cm, top=2.50cm, bottom=2.50cm]{geometry}

%%一些必要的宏包
\RequirePackage[unicode=true,colorlinks,urlcolor=blue,linkcolor=blue,bookmarksnumbered=blue]{hyperref}
\RequirePackage{latexsym,amssymb,amsmath,amsbsy,amsopn,amstext,amsthm,amsxtra,color,bm,calc,ifpdf, xcolor}
\RequirePackage{graphicx}
\RequirePackage{enumerate}
\RequirePackage{titlesec}
\RequirePackage{fancyhdr}
\RequirePackage{listings}
\RequirePackage{multirow}
\RequirePackage{makeidx}
\RequirePackage{xcolor}
\RequirePackage{fontspec}
\RequirePackage{fancyhdr}
\RequirePackage{subfigure}
\RequirePackage{ctex}
\PassOptionsToPackage{hyphens}{url}
\RequirePackage{hyperref}
\RequirePackage{pythonhighlight}
\RequirePackage{tcolorbox}
\RequirePackage{setspace}
\RequirePackage{fontawesome}
\RequirePackage{titletoc}
\RequirePackage{xeCJK} 
% \RequirePackage[document]{ragged2e} 引入后会导致首行无法缩进
\RequirePackage{indentfirst}


% 设置字体
\setCJKfamilyfont{zhsong}[AutoFakeBold = {3}]{SimSun}
\renewcommand*{\songti}{\CJKfamily{zhsong}}
\setCJKmainfont[AutoFakeBold=true]{SimSun}
\setmainfont{Times New Roman}
\onehalfspacing

% 更改摘要二字的样式
\renewcommand{\abstractname}{\textbf{\large {摘\quad 要}}} 

% 可固定下划线长度
\makeatletter
\newcommand\dlmu[2][4cm]{\hskip1pt\underline{\hb@xt@ #1{\hss #2 \hss}}\hskip3pt}
\makeatother

% 对一些autoref的中文引用名作修改
\def\equationautorefname{式}
\def\footnoteautorefname{脚注}
\def\itemautorefname{项}
\def\figureautorefname{图}
\def\tableautorefname{表}
\def\partautorefname{篇}
\def\appendixautorefname{附录}
\def\chapterautorefname{章}
\def\sectionautorefname{节}
\def\subsectionautorefname{小小节}
\def\subsubsectionautorefname{subsubsection}
\def\paragraphautorefname{段落}
\def\subparagraphautorefname{子段落}
\def\FancyVerbLineautorefname{行}
\def\theoremautorefname{定理}

\newtheorem{Theorem}{定理}[section]
\newtheorem{Lemma}[Theorem]{引理}
\newtheorem{Corollary}[Theorem]{推论}
\newtheorem{Proposition}[Theorem]{命题}
\newtheorem{Definition}[Theorem]{定义}
\newtheorem{Example}[Theorem]{例}


% 设置字体
\newcommand{\FourSize}{\normalfont\fontsize{14 bp}{14.4}\selectfont}
\newcommand{\TinyFourSize}{\normalfont\fontsize{12 bp}{14.4}\selectfont}
\newcommand{\ThreeSize}{\normalfont\fontsize{16 bp}{14.4}\selectfont}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}

% 设置section
\titleformat{\section}{\centering\FourSize\bfseries\heiti}{第\,\thesection\,章}{1em}{} % 居中 四号 加粗 黑体
\titleformat{\subsection}{\centering\TinyFourSize\bfseries\heiti}{ \thesubsection }{1em}{} % 居中 小四号 加粗 宋体

% 参考文献设置
\newcommand{\reference}{
%\nocite{*}   %打开此选项会列出bib里面的所有参考文献
\begin{flushleft} %左对齐
    \bibliographystyle{unsrt} %规定了参考文献的格式
	\bibliography{reference} %调出LaTeX生成参考文献列表
\end{flushleft}
}

% 文本框设置
\newcommand{\tbox}[1]{
\begin{center}
\begin{tcolorbox}[colback=gray!10,%gray background
                  colframe=black,% black frame colour
                  width=8cm,% Use 8cm total width,
                  arc=1mm, auto outer arc,
                  boxrule=0.5pt,
                 ]
{#1}
\end{tcolorbox}
\end{center}
}

% 页眉页脚设置
\pagestyle{fancy}
% \fancyhead[L]{}%%留空则不显示
% \fancyhead[C]{}%%留空则不显示
% \fancyhead[R]{}%%留空则不显示
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\cfoot{\thepage}%当前页

% 封面页设置
\newcommand{\Title}[1]{\gdef\Title{#1}}%

\newcommand{\Faculty}[1]{\gdef\Faculty{#1}}%

\newcommand{\Major}[1]{\gdef\Major{#1}}%

\newcommand{\Grade}[1]{\gdef\Grade{#1}}%

\newcommand{\StudentID}[1]{\gdef\StudentID{#1}}%

\newcommand{\Author}[1]{\gdef\Author{#1}}%

\newcommand{\Supervisor}[1]{\gdef\Supervisor{#1}}%

\newcommand{\Date}[3]{ \gdef\Date{ #1 {\songti\Large\textbf{\heiti 年}} #2 {\songti\Large\textbf{\heiti 月}} #3 {\songti\Large\textbf{\heiti 日}} } }%

\newcommand{\CoverSpace}{0.7 cm}

\newcommand{\dlmuLength}{9.5 cm}
{   
    \title{\vspace{-2.25 cm}\heiti \Huge \textbf{{本科毕业论文（设计）}} \par
    \vspace{2.5 cm} }%标题

    \author{
        \vspace{2.5 cm}
        \songti\Huge \textbf{\heiti 题\qquad 目}\ \dlmu[\dlmuLength]{{\Title}} \qquad \\ %题目
        \vspace{\CoverSpace}
        \songti\Large \textbf{\heiti 学\qquad 院}\ \dlmu[\dlmuLength]{{\Faculty}} \qquad \\ %题目
        \vspace{\CoverSpace}
        \songti\Large \textbf{\heiti 专\qquad 业}\ \dlmu[\dlmuLength]{{\Major}} \qquad \\ %题目
        \vspace{\CoverSpace}
        \songti\Large \textbf{\heiti 年\qquad 级}\ \dlmu[\dlmuLength]{{\Grade}} \qquad \\ %题目
        \vspace{\CoverSpace}
        \songti\Large \textbf{\heiti 学\qquad 号}\ \dlmu[\dlmuLength]{{\StudentID}} \qquad \\ %题目
        \vspace{\CoverSpace}
        \songti\Large \textbf{\heiti 姓\qquad 名}\ \dlmu[\dlmuLength]{{\Author}} \qquad \\ %题目
        \vspace{\CoverSpace}
        \songti\Large \textbf{\heiti 指导教师}\ \dlmu[\dlmuLength]{{\Supervisor}} \qquad \\ %题目
        \vspace{\CoverSpace}
        \songti\Large \textbf{\heiti 成\qquad 绩}\ \dlmu[\dlmuLength]{} \qquad \\ %题目
        \vspace{\CoverSpace}
    }
    \date{\Date}
}

% 在这里可更改封面logo
\newcommand{\cover}{
% 封面校名logo，图片都在figures文件夹里
\begin{figure}
	\centering
	\includegraphics[width=0.3\textwidth]{figures/swu_logo.png}
\end{figure} 

\maketitle
}

% 设置引用样式
\hypersetup{
    colorlinks=true,
    linkcolor=black, % This will make the link text black
    citecolor=black,
    urlcolor=black
}

%% 摘要格式
\newcommand{\chineseabstract}[2]{
    \begin{center}
        {\centering\heiti\zihao{3}\Title}
        \vspace{\baselineskip}

        {\centering\songti\zihao{-4}\Author}

        {\centering\songti\zihao{5}西南大学\Faculty，重庆 400715}
        \vspace{\baselineskip}

        \leftline{\noindent{\bfseries\heiti\zihao{5}摘要：}{\fangsong\zihao{5}#1\par} }
        \leftline{\noindent{\bfseries\heiti\zihao{5}关键词：}{\fangsong\zihao{5}#2} }
        \vspace{2em}
        \phantomsection
        \addcontentsline{toc}{section}{摘要}
    \end{center}
}

\newcommand{\englishabstract}[5]{
    \begin{center}
    
        {\centering\zihao{4}\bfseries#1}
        \vspace{\baselineskip}

        {\centering\zihao{5}#2}

        {\centering\zihao{-5}School of #3, Southwest University, Chongqing  400715, PR China}
        \vspace{\baselineskip}

        \leftline{\noindent{\bfseries\zihao{5}Abstract: }{\zihao{5}#4\par} }
        \leftline{\noindent{\bfseries\zihao{5}Key words: }{\zihao{5}#5} }
        \vspace{2em}
        \phantomsection
        \addcontentsline{toc}{section}{Abstract}
    \end{center}
}

% 设置目录格式
\renewcommand{\contentsname}{\hfill\bfseries\zihao{3}目\qquad 录\hfill} % Centered, bold, and size "three"

% Format for sections (treated as chapters)
\titlecontents{section}
[0em] % Left indent
{\addvspace{1em}} % Space above the entry
{第\thecontentslabel 章\quad} % Before with label
{} % Before without label
{\titlerule*{.}\contentspage} % Filler-page format

% Format for subsections
\titlecontents{subsection}
[1.5em] % Left indent
{\addvspace{0.5em}} % Space above the entry
{\thecontentslabel\quad} % Before with label
{} % Before without label
{\titlerule*{.}\contentspage} % Filler-page format

% tableofcontents
\let\oldtableofcontents\tableofcontents
\renewcommand{\tableofcontents}{
  {\zihao{-4}\oldtableofcontents}

  \thispagestyle{empty} % 目录不显示页码
}

% 致谢
\newcommand{\acknowledgment}[1]{
    \begin{flushleft}
        {\bfseries\noindent\songti\zihao{-4}致谢}
    \end{flushleft}\vspace{-0.2 cm}
    {\qquad\songti\zihao{5}\linespread{1}#1}
    \addcontentsline{toc}{section}{致谢}
}

% 附录
\renewcommand{\appendix}[1]{
    \begin{flushleft}
        {\bfseries\noindent\heiti\zihao{-2}附录}
    \end{flushleft}
    #1
    \addcontentsline{toc}{section}{附录}
}
